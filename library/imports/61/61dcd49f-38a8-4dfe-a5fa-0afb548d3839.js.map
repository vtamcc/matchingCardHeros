{"version":3,"sources":["assets\\MatchingCardHeros\\scripts\\game\\popup\\Shop\\CardHero.ItemShop.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Global } from \"../../../CardHero.Global\";\r\nimport GameView from \"../../CardHero.GameView\";\r\nimport Level from \"../../CardHero.LevelView\";\r\nimport ShopView from \"./CardHero.ShopView\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ItemShop extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    nItem: cc.Node = null;\r\n    @property(cc.Node)\r\n    nMask: cc.Node = null;\r\n    // @property(cc.Label)\r\n    // lbPrice: cc.Label = null;\r\n\r\n    idItem = 0;\r\n    price: number = 0;\r\n\r\n    onLoad() {}\r\n\r\n    setData(id, price) {\r\n        this.idItem = id;\r\n        this.price = price;\r\n        this.loadItemState(); \r\n        this.nItem.getComponent(cc.Sprite).spriteFrame = ShopView.instance.listSpfItem[id];\r\n        this.updatePrice();\r\n        this.checkBuy();\r\n    }\r\n\r\n    updatePrice() {\r\n        this.price = Global.priceItem[this.idItem];\r\n    }\r\n\r\n    checkBuy() {\r\n        if (Global.totalGold >= this.price) {\r\n            this.nMask.active = false;\r\n            console.log(\"xzzzzzzz\",this.price)\r\n        } else {\r\n            this.nMask.active = true;\r\n        }\r\n    }\r\n\r\n    clickBuy() {\r\n        if (Global.totalGold >= this.price) {\r\n            Global.totalGold -= this.price;\r\n            if (this.idItem == 0) {\r\n                Global.hpChar += 5;\r\n                cc.sys.localStorage.setItem(\"hpChar\", Global.hpChar);\r\n                console.log(`HpChar increased to: ${Global.hpChar}`);\r\n            } else if (this.idItem == 1) {\r\n                Global.dameCharSmall += 3;\r\n                Global.dameCharNormal += 3;\r\n                Global.dameCharBig += 3;\r\n                cc.sys.localStorage.setItem(\"dameCharSmall\", Global.dameCharSmall);\r\n                cc.sys.localStorage.setItem(\"dameCharNormal\", Global.dameCharNormal);\r\n                cc.sys.localStorage.setItem(\"dameCharBig\", Global.dameCharBig);\r\n                console.log(`Damage increased to: Small: ${Global.dameCharSmall}, Normal: ${Global.dameCharNormal}, Big: ${Global.dameCharBig}`);\r\n            }\r\n\r\n            Global.priceItem[this.idItem]++;\r\n            this.saveItemState(); // Save item state after purchase\r\n            console.log(`Bought item ${this.idItem}, new price: ${Global.priceItem[this.idItem]}, remaining gold: ${Global.totalGold}`);\r\n            ShopView.instance.updateAllItems(); // Update all items\r\n            ShopView.instance.updatePrices();\r\n            Level.instance.updateGold(); // Update the displayed gold amount\r\n            this.updatePrice(); // Update the price after purchase\r\n        } else {\r\n            console.log(\"Not enough gold!\");\r\n        }\r\n    }\r\n\r\n    saveItemState() {\r\n        const itemState = {\r\n            id: this.idItem,\r\n            price: Global.priceItem[this.idItem]\r\n        };\r\n        cc.sys.localStorage.setItem(`item_${this.idItem}`, JSON.stringify(itemState));\r\n        console.log(`Item ${this.idItem} state saved:`, itemState);\r\n    }\r\n\r\n    loadItemState() {\r\n        const itemState = cc.sys.localStorage.getItem(`item_${this.idItem}`);\r\n        if (itemState) {\r\n            const parsedState = JSON.parse(itemState);\r\n            Global.priceItem[this.idItem] = parsedState.price;\r\n            this.price = parsedState.price;\r\n            console.log(`Loaded price for item ${this.idItem}: ${this.price}`);\r\n        }\r\n    }\r\n\r\n    start() {}\r\n\r\n    // update (dt) {}\r\n}"]}